{"ast":null,"code":"import React,{useEffect,useState,useRef}from\"react\";import\"../Css/Navbar.css\";import{Link,useNavigate,useLocation}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Navbar(){const[userName,setUserName]=useState(null);const[systemRole,setSystemRole]=useState(null);// ADMIN / USER\nconst[showMenu,setShowMenu]=useState(false);const[loading,setLoading]=useState(true);// ‚≠ê NEW\nconst navigate=useNavigate();const location=useLocation();const dropdownRef=useRef(null);/* ==============================\r\n     LOAD USER FROM SESSION (SAFE)\r\n  ============================== */useEffect(()=>{const loadProfile=async()=>{try{const res=await fetch(\"/api/user/get-profile\",{credentials:\"include\",cache:\"no-store\"});if(!res.ok){setUserName(null);setSystemRole(null);return;}const data=await res.json();if((data===null||data===void 0?void 0:data.status)===\"error\"||!(data!==null&&data!==void 0&&data.fullName)){setUserName(null);setSystemRole(null);}else{setUserName(data.fullName);setSystemRole(data.systemRole||null);}}catch(err){console.error(\"Navbar profile error:\",err);setUserName(null);setSystemRole(null);}finally{setLoading(false);// ‚≠ê IMPORTANT\n}};setLoading(true);loadProfile();setShowMenu(false);},[location.pathname]);/* ==============================\r\n     CLOSE DROPDOWN ON OUTSIDE CLICK\r\n  ============================== */useEffect(()=>{const handleClickOutside=event=>{if(dropdownRef.current&&!dropdownRef.current.contains(event.target)){setShowMenu(false);}};document.addEventListener(\"mousedown\",handleClickOutside);return()=>document.removeEventListener(\"mousedown\",handleClickOutside);},[]);/* ==============================\r\n     LOGOUT (FINAL)\r\n  ============================== */const handleLogout=async()=>{try{await fetch(\"/api/auth/logout\",{method:\"POST\",credentials:\"include\"});}catch(_unused){}// üî• CLEAR STATE\nsetUserName(null);setSystemRole(null);setShowMenu(false);// üî• HARD RELOAD\nwindow.location.replace(\"/login\");};/* ==============================\r\n     PREVENT FLICKER\r\n  ============================== */if(loading)return null;return/*#__PURE__*/_jsxs(\"nav\",{className:\"nav\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"nav-left\",onClick:()=>navigate(\"/home\"),style:{cursor:\"pointer\"},children:/*#__PURE__*/_jsx(\"img\",{src:\"/Images/Logo1.png\",alt:\"AgroLink Logo\",className:\"logo\"})}),/*#__PURE__*/_jsxs(\"ul\",{className:\"nav-menu\",children:[/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/home\"),children:\"Home\"}),/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/marketplace\"),children:\"Marketplace\"}),/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/marketplace/seeds\"),children:\"Inputs\"}),/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/loans\"),children:\"Loans\"}),/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/insurance\"),children:\"Insurance\"}),/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/impact\"),children:\"Impact\"}),/*#__PURE__*/_jsx(\"li\",{onClick:()=>navigate(\"/contact\"),children:\"Contact\"})]}),userName?/*#__PURE__*/_jsxs(\"div\",{className:\"profile-dropdown-container\",ref:dropdownRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"profile-mini\",onClick:()=>setShowMenu(prev=>!prev),children:[/*#__PURE__*/_jsx(\"div\",{className:\"profile-circle\",children:userName.charAt(0).toUpperCase()}),/*#__PURE__*/_jsx(\"span\",{className:\"profile-text\",children:userName})]}),showMenu&&/*#__PURE__*/_jsxs(\"div\",{className:\"profile-dropdown\",children:[/*#__PURE__*/_jsx(\"p\",{onClick:()=>navigate(\"/profile\"),children:\"My Profile\"}),/*#__PURE__*/_jsx(\"p\",{onClick:()=>navigate(\"/dashboard\"),children:\"Dashboard\"}),systemRole===\"ADMIN\"&&/*#__PURE__*/_jsx(\"p\",{onClick:()=>navigate(\"/admin\"),children:\"Admin Dashboard\"}),/*#__PURE__*/_jsx(\"p\",{className:\"logout\",onClick:handleLogout,children:\"Logout\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"nav-btns\",children:[/*#__PURE__*/_jsx(Link,{to:\"/signup\",children:/*#__PURE__*/_jsx(\"button\",{className:\"signup\",children:\"Sign Up\"})}),/*#__PURE__*/_jsx(Link,{to:\"/login\",children:/*#__PURE__*/_jsx(\"button\",{className:\"login\",children:\"Log In\"})})]})]});}export default Navbar;","map":{"version":3,"names":["React","useEffect","useState","useRef","Link","useNavigate","useLocation","jsx","_jsx","jsxs","_jsxs","Navbar","userName","setUserName","systemRole","setSystemRole","showMenu","setShowMenu","loading","setLoading","navigate","location","dropdownRef","loadProfile","res","fetch","credentials","cache","ok","data","json","status","fullName","err","console","error","pathname","handleClickOutside","event","current","contains","target","document","addEventListener","removeEventListener","handleLogout","method","_unused","window","replace","className","children","onClick","style","cursor","src","alt","ref","prev","charAt","toUpperCase","to"],"sources":["D:/AgroLink/frontend/src/components/Navbar.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\r\nimport \"../Css/Navbar.css\";\r\nimport { Link, useNavigate, useLocation } from \"react-router-dom\";\r\n\r\nfunction Navbar() {\r\n  const [userName, setUserName] = useState(null);\r\n  const [systemRole, setSystemRole] = useState(null); // ADMIN / USER\r\n  const [showMenu, setShowMenu] = useState(false);\r\n  const [loading, setLoading] = useState(true); // ‚≠ê NEW\r\n\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const dropdownRef = useRef(null);\r\n\r\n  /* ==============================\r\n     LOAD USER FROM SESSION (SAFE)\r\n  ============================== */\r\n  useEffect(() => {\r\n    const loadProfile = async () => {\r\n      try {\r\n        const res = await fetch(\"/api/user/get-profile\", {\r\n          credentials: \"include\",\r\n          cache: \"no-store\",\r\n        });\r\n\r\n        if (!res.ok) {\r\n          setUserName(null);\r\n          setSystemRole(null);\r\n          return;\r\n        }\r\n\r\n        const data = await res.json();\r\n\r\n        if (data?.status === \"error\" || !data?.fullName) {\r\n          setUserName(null);\r\n          setSystemRole(null);\r\n        } else {\r\n          setUserName(data.fullName);\r\n          setSystemRole(data.systemRole || null);\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Navbar profile error:\", err);\r\n        setUserName(null);\r\n        setSystemRole(null);\r\n      } finally {\r\n        setLoading(false); // ‚≠ê IMPORTANT\r\n      }\r\n    };\r\n\r\n    setLoading(true);\r\n    loadProfile();\r\n    setShowMenu(false);\r\n  }, [location.pathname]);\r\n\r\n  /* ==============================\r\n     CLOSE DROPDOWN ON OUTSIDE CLICK\r\n  ============================== */\r\n  useEffect(() => {\r\n    const handleClickOutside = (event) => {\r\n      if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {\r\n        setShowMenu(false);\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () =>\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n  /* ==============================\r\n     LOGOUT (FINAL)\r\n  ============================== */\r\n  const handleLogout = async () => {\r\n    try {\r\n      await fetch(\"/api/auth/logout\", {\r\n        method: \"POST\",\r\n        credentials: \"include\",\r\n      });\r\n    } catch {}\r\n\r\n    // üî• CLEAR STATE\r\n    setUserName(null);\r\n    setSystemRole(null);\r\n    setShowMenu(false);\r\n\r\n    // üî• HARD RELOAD\r\n    window.location.replace(\"/login\");\r\n  };\r\n\r\n  /* ==============================\r\n     PREVENT FLICKER\r\n  ============================== */\r\n  if (loading) return null;\r\n\r\n  return (\r\n    <nav className=\"nav\">\r\n      {/* LOGO */}\r\n      <div\r\n        className=\"nav-left\"\r\n        onClick={() => navigate(\"/home\")}\r\n        style={{ cursor: \"pointer\" }}\r\n      >\r\n        <img src=\"/Images/Logo1.png\" alt=\"AgroLink Logo\" className=\"logo\" />\r\n      </div>\r\n\r\n      {/* MENU */}\r\n      <ul className=\"nav-menu\">\r\n        <li onClick={() => navigate(\"/home\")}>Home</li>\r\n        <li onClick={() => navigate(\"/marketplace\")}>Marketplace</li>\r\n        <li onClick={() => navigate(\"/marketplace/seeds\")}>Inputs</li>\r\n        <li onClick={() => navigate(\"/loans\")}>Loans</li>\r\n        <li onClick={() => navigate(\"/insurance\")}>Insurance</li>\r\n        <li onClick={() => navigate(\"/impact\")}>Impact</li>\r\n        <li onClick={() => navigate(\"/contact\")}>Contact</li>\r\n      </ul>\r\n\r\n      {/* USER / AUTH */}\r\n      {userName ? (\r\n        <div className=\"profile-dropdown-container\" ref={dropdownRef}>\r\n          <div\r\n            className=\"profile-mini\"\r\n            onClick={() => setShowMenu((prev) => !prev)}\r\n          >\r\n            <div className=\"profile-circle\">\r\n              {userName.charAt(0).toUpperCase()}\r\n            </div>\r\n            <span className=\"profile-text\">{userName}</span>\r\n          </div>\r\n\r\n          {showMenu && (\r\n            <div className=\"profile-dropdown\">\r\n              <p onClick={() => navigate(\"/profile\")}>My Profile</p>\r\n              <p onClick={() => navigate(\"/dashboard\")}>Dashboard</p>\r\n\r\n              {/* ‚≠ê ADMIN ONLY */}\r\n              {systemRole === \"ADMIN\" && (\r\n                <p onClick={() => navigate(\"/admin\")}>Admin Dashboard</p>\r\n              )}\r\n\r\n              <p className=\"logout\" onClick={handleLogout}>\r\n                Logout\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      ) : (\r\n        <div className=\"nav-btns\">\r\n          <Link to=\"/signup\">\r\n            <button className=\"signup\">Sign Up</button>\r\n          </Link>\r\n          <Link to=\"/login\">\r\n            <button className=\"login\">Log In</button>\r\n          </Link>\r\n        </div>\r\n      )}\r\n    </nav>\r\n  );\r\n}\r\n\r\nexport default Navbar;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
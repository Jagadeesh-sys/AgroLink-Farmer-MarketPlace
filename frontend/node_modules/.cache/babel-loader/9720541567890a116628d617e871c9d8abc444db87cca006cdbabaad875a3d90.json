{"ast":null,"code":"import _objectSpread from\"D:/AgroLink/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from\"react\";import\"../Css/Buy.css\";import Navbar from\"../components/Navbar\";import Footer from\"../components/Footer\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Buy(){const[search,setSearch]=useState(\"\");const[crops,setCrops]=useState([]);const[loading,setLoading]=useState(true);const[cart,setCart]=useState([]);// Load previous cart\nuseEffect(()=>{const saved=localStorage.getItem(\"cart\");if(saved)setCart(JSON.parse(saved));},[]);// Save cart on update\nuseEffect(()=>{localStorage.setItem(\"cart\",JSON.stringify(cart));},[cart]);// Fetch all crops (includes quantity, soldQty, availableStock)\nuseEffect(()=>{fetch(\"http://localhost:9090/backend/api/crop/all\").then(res=>res.json()).then(data=>{if(Array.isArray(data)){setCrops(data);}else{setCrops([]);}}).catch(err=>{console.error(\"Failed to load crops:\",err);setCrops([]);}).finally(()=>setLoading(false));},[]);// Build image URL\nconst getImage=imgStr=>{if(!imgStr)return\"/Images/noimg.png\";const first=imgStr.split(\",\")[0].trim();return\"http://localhost:9090/backend/uploads/\".concat(first);};// Add to Cart\nconst addToCart=crop=>{var _crop$availableStock;const available=Number((_crop$availableStock=crop.availableStock)!==null&&_crop$availableStock!==void 0?_crop$availableStock:crop.quantity-crop.soldQty)||0;const exists=cart.find(c=>c.cropId===crop.cropId);if(exists){if(exists.qty<available){setCart(cart.map(c=>c.cropId===crop.cropId?_objectSpread(_objectSpread({},c),{},{qty:c.qty+1}):c));}else{alert(\"Not enough stock available\");}}else{const newItem={cropId:crop.cropId,farmerId:crop.farmerId,cropName:crop.cropName,price:Number(crop.price),images:crop.images,quantity:Number(crop.quantity),soldQty:Number(crop.soldQty),availableStock:available,qty:1};setCart([...cart,newItem]);}alert(\"\".concat(crop.cropName,\" added to cart!\"));};// Filter crops\nconst filtered=crops.filter(c=>c.cropName.toLowerCase().includes(search.toLowerCase()));return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"buy-container\",style:{marginTop:\"80px\"},children:[/*#__PURE__*/_jsxs(\"h2\",{className:\"buy-title\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-handshake\"}),\" Buy Fresh Produce\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"buy-search-box\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-search\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search crops... (Tomato, Wheat, etc)\",value:search,onChange:e=>setSearch(e.target.value)})]}),loading&&/*#__PURE__*/_jsx(\"p\",{className:\"loading\",children:\"Loading crops...\"}),!loading&&filtered.length===0&&/*#__PURE__*/_jsx(\"p\",{className:\"no-data\",children:\"No crops found.\"}),/*#__PURE__*/_jsx(\"div\",{className:\"buy-grid\",children:filtered.map(item=>{var _item$availableStock;return/*#__PURE__*/_jsxs(\"div\",{className:\"buy-card\",children:[/*#__PURE__*/_jsx(\"img\",{src:getImage(item.images),alt:item.cropName,className:\"buy-img\",onError:e=>e.target.src=\"/Images/noimg.png\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"buy-name\",children:item.cropName}),/*#__PURE__*/_jsxs(\"p\",{className:\"buy-price\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-rupee-sign\"}),\" \",item.price,\" / Kg\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"buy-stock\",children:[/*#__PURE__*/_jsx(\"b\",{children:\"Available:\"}),\" \",Number((_item$availableStock=item.availableStock)!==null&&_item$availableStock!==void 0?_item$availableStock:item.quantity-item.soldQty),\" Kg\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"buy-btn\",onClick:()=>addToCart(item),children:[/*#__PURE__*/_jsx(\"i\",{className:\"fa fa-shopping-cart\"}),\" Add to Cart\"]})]},item.cropId);})})]}),/*#__PURE__*/_jsx(Footer,{})]});}export default Buy;","map":{"version":3,"names":["React","useState","useEffect","Navbar","Footer","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Buy","search","setSearch","crops","setCrops","loading","setLoading","cart","setCart","saved","localStorage","getItem","JSON","parse","setItem","stringify","fetch","then","res","json","data","Array","isArray","catch","err","console","error","finally","getImage","imgStr","first","split","trim","concat","addToCart","crop","_crop$availableStock","available","Number","availableStock","quantity","soldQty","exists","find","c","cropId","qty","map","_objectSpread","alert","newItem","farmerId","cropName","price","images","filtered","filter","toLowerCase","includes","children","className","style","marginTop","type","placeholder","value","onChange","e","target","length","item","_item$availableStock","src","alt","onError","onClick"],"sources":["D:/AgroLink/frontend/src/pages/Buy.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport \"../Css/Buy.css\";\r\nimport Navbar from \"../components/Navbar\";\r\nimport Footer from \"../components/Footer\";\r\n\r\nfunction Buy() {\r\n  const [search, setSearch] = useState(\"\");\r\n  const [crops, setCrops] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [cart, setCart] = useState([]);\r\n\r\n  // Load previous cart\r\n  useEffect(() => {\r\n    const saved = localStorage.getItem(\"cart\");\r\n    if (saved) setCart(JSON.parse(saved));\r\n  }, []);\r\n\r\n  // Save cart on update\r\n  useEffect(() => {\r\n    localStorage.setItem(\"cart\", JSON.stringify(cart));\r\n  }, [cart]);\r\n\r\n  // Fetch all crops (includes quantity, soldQty, availableStock)\r\n  useEffect(() => {\r\n    fetch(\"http://localhost:9090/backend/api/crop/all\")\r\n      .then((res) => res.json())\r\n      .then((data) => {\r\n        if (Array.isArray(data)) {\r\n          setCrops(data);\r\n        } else {\r\n          setCrops([]);\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        console.error(\"Failed to load crops:\", err);\r\n        setCrops([]);\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, []);\r\n\r\n  // Build image URL\r\n  const getImage = (imgStr) => {\r\n    if (!imgStr) return \"/Images/noimg.png\";\r\n    const first = imgStr.split(\",\")[0].trim();\r\n    return `http://localhost:9090/backend/uploads/${first}`;\r\n  };\r\n\r\n  // Add to Cart\r\n  const addToCart = (crop) => {\r\n    const available =\r\n      Number(crop.availableStock ?? crop.quantity - crop.soldQty) || 0;\r\n\r\n    const exists = cart.find((c) => c.cropId === crop.cropId);\r\n\r\n    if (exists) {\r\n      if (exists.qty < available) {\r\n        setCart(\r\n          cart.map((c) =>\r\n            c.cropId === crop.cropId ? { ...c, qty: c.qty + 1 } : c\r\n          )\r\n        );\r\n      } else {\r\n        alert(\"Not enough stock available\");\r\n      }\r\n    } else {\r\n      const newItem = {\r\n        cropId: crop.cropId,\r\n        farmerId: crop.farmerId,\r\n        cropName: crop.cropName,\r\n        price: Number(crop.price),\r\n        images: crop.images,\r\n        quantity: Number(crop.quantity),\r\n        soldQty: Number(crop.soldQty),\r\n        availableStock: available,\r\n        qty: 1,\r\n      };\r\n\r\n      setCart([...cart, newItem]);\r\n    }\r\n\r\n    alert(`${crop.cropName} added to cart!`);\r\n  };\r\n\r\n  // Filter crops\r\n  const filtered = crops.filter((c) =>\r\n    c.cropName.toLowerCase().includes(search.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {/* ⭐ NAVBAR (top) */}\r\n      <Navbar />\r\n\r\n      {/* ⭐ MAIN CONTENT */}\r\n      <div className=\"buy-container\" style={{ marginTop: \"80px\" }}>\r\n        <h2 className=\"buy-title\">\r\n          <i className=\"fa fa-handshake\"></i> Buy Fresh Produce\r\n        </h2>\r\n\r\n        {/* Search Bar */}\r\n        <div className=\"buy-search-box\">\r\n          <i className=\"fa fa-search\"></i>\r\n          <input\r\n            type=\"text\"\r\n            placeholder=\"Search crops... (Tomato, Wheat, etc)\"\r\n            value={search}\r\n            onChange={(e) => setSearch(e.target.value)}\r\n          />\r\n        </div>\r\n\r\n        {loading && <p className=\"loading\">Loading crops...</p>}\r\n\r\n        {!loading && filtered.length === 0 && (\r\n          <p className=\"no-data\">No crops found.</p>\r\n        )}\r\n\r\n        {/* Crop Cards */}\r\n        <div className=\"buy-grid\">\r\n          {filtered.map((item) => (\r\n            <div className=\"buy-card\" key={item.cropId}>\r\n              <img\r\n                src={getImage(item.images)}\r\n                alt={item.cropName}\r\n                className=\"buy-img\"\r\n                onError={(e) => (e.target.src = \"/Images/noimg.png\")}\r\n              />\r\n\r\n              <h3 className=\"buy-name\">{item.cropName}</h3>\r\n\r\n              <p className=\"buy-price\">\r\n                <i className=\"fa fa-rupee-sign\"></i> {item.price} / Kg\r\n              </p>\r\n\r\n              {/* Stock Display */}\r\n              <p className=\"buy-stock\">\r\n                <b>Available:</b>{\" \"}\r\n                {Number(item.availableStock ?? item.quantity - item.soldQty)} Kg\r\n              </p>\r\n\r\n              <button className=\"buy-btn\" onClick={() => addToCart(item)}>\r\n                <i className=\"fa fa-shopping-cart\"></i> Add to Cart\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* ⭐ FOOTER (bottom) */}\r\n      <Footer />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Buy;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}